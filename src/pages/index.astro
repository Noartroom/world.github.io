---
import Layout from '@/layouts/Layout.astro';
import IamfPlayer from '@/components/IamfPlayer.astro';
import Renderer from '@/components/Renderer.astro';
---
<Layout title="Astro Prototype">
  <main>
    <h1 id="page-title" class="floating-title">TITLE</h1>
    <div class="global-controls">
      <button id="themeToggle" class="global-toggle">Toggle Theme</button>
      <button id="modelToggle" class="global-toggle">Switch Model</button>
      <button id="light-engine-toggle" class="global-toggle">Toggle Dynamic Light</button>
    </div>
    <Renderer />
    
    <!-- <IamfPlayer /> -->
    <IamfPlayer />
  </main>
</Layout>
<script>
  // This script controls the global buttons
  import { theme, activeModel, isDynamicLightActive } from '../stores/sceneStore';

  const themeButton = document.getElementById('themeToggle');
  themeButton?.addEventListener('click', () => {
    const currentTheme = theme.get();
    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
    const currentModel = activeModel.get();
    
    theme.set(newTheme);
    
    // Only switch the model if it doesn't match the new theme
    if (currentModel !== newTheme) {
      activeModel.set(newTheme);
    }
  });

  const modelButton = document.getElementById('modelToggle');
  modelButton?.addEventListener('click', () => {
    const current = activeModel.get();
    const newModel = current === 'light' ? 'dark' : 'light';
    // Only update if different to avoid unnecessary triggers
    if (current !== newModel) {
      activeModel.set(newModel);
    }
  });

  const lightButton = document.getElementById('light-engine-toggle');
  lightButton?.addEventListener('click', () => {
    isDynamicLightActive.set(!isDynamicLightActive.get());
  });
</script>

<style>
  main {
    width: 100vw;
    height: 100vh;
    overflow: hidden; /* Make it full-screen */
    /* Clicks go through */
    pointer-events: none; 
    background: transparent;
  }
  .global-controls {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
    pointer-events: auto; /* Re-enable clicking */
  }
  .global-toggle {
    padding: 0.5em 1em;
    background: #444;
    color: white;
  }
  .global-toggle:hover {
    background: #646cff;
  }
  .floating-title {
    position: absolute;
    top: 15%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 6rem;
    font-weight: 900;
    color: rgba(255, 255, 255, 0.9);
    pointer-events: none;
    z-index: 5;
    text-transform: uppercase;
    letter-spacing: 0.5rem;
    
    /* Dynamic Shadow based on light position */
    --shadow-x: calc((var(--light-x, 50vw) - 50vw) * -0.1);
    --shadow-y: calc((var(--light-y, 50vh) - 50vh) * -0.1);
    --shadow-blur: calc(10px + (var(--light-intensity, 0) * 20px));
    --shadow-color: rgba(0, 0, 0, 0.5);
    
    filter: drop-shadow(var(--shadow-x) var(--shadow-y) var(--shadow-blur) var(--shadow-color));
    transition: filter 0.1s ease-out;
  }
</style>