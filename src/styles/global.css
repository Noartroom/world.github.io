/* Based on your 'style.css' for modern light/dark theming */
:root {
  /* let the browser know this has light and dark mode */
  color-scheme: light dark;

  /* Theme toggle variables from your file */
  --sun-color: black;
  --moon-color: transparent;

  /* Global light position variables (set by Renderer.astro) */
  --light-x: 50vw;
  --light-y: 50vh;
  --light-intensity: 0;
}

body {
  font: 16px -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue",
    Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
    "Segoe UI Symbol", "Noto Color Emoji";
  
  /* Use light-dark() functions for base colors */
  color: light-dark(#444, #fff);
  background-color: transparent;

  /* Make the app full-page */
  margin: 0;
  padding: 0;
  width: 100%;
  min-height: 100vh;

  /* Clicks go through Body to Canvas */
  pointer-events: none;
  
  /* Fix for mobile blue flicker/highlight */
  -webkit-tap-highlight-color: transparent;
}

/* Fallback for browsers that don't support light-dark() (e.g., iOS Safari) */
@supports not (color: light-dark(#000, #fff)) {
  body {
    color: #444; /* Default light mode color */
  }
  
  body.dark-mode {
    color: #fff; /* Dark mode color */
  }
  
  body.light-mode {
    color: #444; /* Light mode color */
  }
}

h1, h2, h3 {
  line-height: 1.2;
}

/* Interactive Elements stay clickable */
button, a, input, select, label {
  pointer-events: auto;
}

button {
  background-color: light-dark(#c9d1d9, #444);
  color: light-dark(#444, #c9d1d9);
  padding: 8px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
}

/* Fallback for browsers that don't support light-dark() (e.g., iOS Safari) */
@supports not (color: light-dark(#000, #fff)) {
  button {
    background-color: #c9d1d9; /* Default light mode background */
    color: #444; /* Default light mode text */
  }
  
  body.dark-mode button {
    background-color: #444; /* Dark mode background */
    color: #c9d1d9; /* Dark mode text */
  }
  
  body.light-mode button {
    background-color: #c9d1d9; /* Light mode background */
    color: #444; /* Light mode text */
  }
}

a:link {
  color: light-dark(#58a6ff, #bf753d);
}
a:visited {
  color: light-dark(#434669, #785438);
}

/* Fallback for browsers that don't support light-dark() (e.g., iOS Safari) */
@supports not (color: light-dark(#000, #fff)) {
  a:link {
    color: #58a6ff; /* Default light mode link color */
  }
  
  body.dark-mode a:link {
    color: #bf753d; /* Dark mode link color */
  }
  
  body.light-mode a:link {
    color: #58a6ff; /* Light mode link color */
  }
  
  a:visited {
    color: #434669; /* Default light mode visited color */
  }
  
  body.dark-mode a:visited {
    color: #785438; /* Dark mode visited color */
  }
  
  body.light-mode a:visited {
    color: #434669; /* Light mode visited color */
  }
}

/* Theme toggle styles from your 'style.css' */
.sun {
  fill: var(--sun-color, black);
}
.moon {
  fill: var(--moon-color, transparent);
}

/* Override themes (from your 'style.css') */
/* This is controlled by our theme button */
.dark-mode {
  color-scheme: only dark;
  --sun-color: transparent;
  --moon-color: white;
}

.light-mode {
  color-scheme: only light;
  --sun-color: black;
  --moon-color: transparent;
}

/* --- Layer Specific Styles --- */

/* 
  Layer Z-Index Logic:
  - Persistent UI (#layer-persistent): 100 (Always Top)
  
  Default Mode:
  - Front Layer (#layer-front): 2 (Above Canvas)
  - Middle Layer (#layer-middle): 1 (Canvas)
  - Back Layer (#layer-back): 0 (Behind Canvas)
  
  Back Layer Mode (.layer-back-active):
  - Back Layer (#layer-back): 5 (Moves ABOVE Canvas and Front Layer)
  - Middle Layer (#layer-middle): 1
  - Front Layer (#layer-front): 2 (But Hidden via Opacity)
*/

/* Back Layer Reveal Effect (The Torch) */
/* When Back Layer is active, we apply the torch effect and move it to front */
/* Moving "Down" (to Back) -> Room moves Up from 150vh to 0 */
body.layer-back-active #layer-back,
body.layer-back-active #bg-layer-back {
  /* opacity: 1 !important; Removed to fix Firefox ViewTransition bug */
  pointer-events: none !important; /* Pass-through interaction to 3D scene */
  
  /* Reset vertical translation to 0 (slide up effect) */
  transform: translateY(0) translateX(0) !important;
  z-index: 5 !important; /* Move above everything else (except persistent UI) */
  transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
}

/* Disable transitions on initial page load for instant appearance */
body.initial-load #layer-back,
body.initial-load #bg-layer-back,
body.initial-load #layer-right,
body.initial-load #bg-layer-right,
body.initial-load #layer-front,
body.initial-load #bg-layer-front,
body.initial-load .room-content {
  transition: none !important;
}

/* Enhanced transition for leaving deep layer (0,0,0) towards front (0,0,1) */
/* Moving "Up" (to Front) -> Old room (Back) moves "Down" */
body:not(.layer-back-active):not(.layer-right-active) #layer-back,
body:not(.layer-back-active):not(.layer-right-active) #bg-layer-back {
    transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
    transform: translateY(150vh) translateX(0) !important; /* Move down/away significantly */
    opacity: 0;
    pointer-events: none;
}

/* Lateral transition between Back (0,0,0) and Right (1,0,0) */
/* When Right is active, slide it in; push Back to the left */
body.layer-right-active #layer-right,
body.layer-right-active #bg-layer-right {
    transform: translateX(0) translateY(0) !important;
    transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
    pointer-events: none;
    opacity: 1;
}

body.layer-right-active #layer-back,
body.layer-right-active #bg-layer-back {
    transform: translateX(-150vw) translateY(0) !important;
    transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
    opacity: 0;
    pointer-events: none;
}

/* When Right is not active, keep Right off-screen to the right */
body:not(.layer-right-active) #layer-right,
body:not(.layer-right-active) #bg-layer-right {
    transform: translateX(150vw) translateY(0) !important;
    transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
    opacity: 0;
    pointer-events: none;
}

/* Hide Front layer while Right is active (to avoid overlay) */
body.layer-right-active #layer-front,
body.layer-right-active #bg-layer-front {
    transform: translateX(150vw) translateY(0) !important;
    opacity: 0 !important;
    pointer-events: none !important;
    transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
}

/* When Right is not active, restore Front (unless Back logic overrides via Y) */
body:not(.layer-right-active) #layer-front,
body:not(.layer-right-active) #bg-layer-front {
    transform: translateX(0) !important;
}

/* Mobile mask override removed - mask-image no longer used */

/* Allow interaction with actual content in Back Layer */
body.layer-back-active #layer-back .room-content {
  pointer-events: none !important;
  cursor: default; /* Prevent flickering to text cursor */
  transform: translateY(-38vh); /* Move text to top to avoid blocking interaction */
  /* Active: Light=Black 1.0, Dark=White 1.0 */
  color: light-dark(rgba(0, 0, 0, 1), rgba(255, 255, 255, 1));
}

/* Fallback for browsers that don't support light-dark() (e.g., iOS Safari) */
@supports not (color: light-dark(#000, #fff)) {
  body.layer-back-active #layer-back .room-content {
    color: rgba(0, 0, 0, 1); /* Default light mode color */
  }
  
  body.layer-back-active.dark-mode #layer-back .room-content {
    color: rgba(255, 255, 255, 1); /* Dark mode color */
  }
  
  body.layer-back-active.light-mode #layer-back .room-content {
    color: rgba(0, 0, 0, 1); /* Light mode color */
  }
}

/* Smooth transition for text position matches wireframe animation */
.room-content {
  transform: translateY(0);
  transition: transform 1.5s cubic-bezier(0.2, 0.8, 0.2, 1);
}

/* When Back Layer is active, hide the Front Layer (Audio Player, etc.) */
/* Front layer moves UP (to -150vh) as we go "Down" to back layer */
body.layer-back-active #layer-front,
body.layer-back-active #bg-layer-front {
  transform: translateY(-150vh) !important;
  opacity: 0 !important;
  pointer-events: none !important;
  transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
}

/* Default State (Front Layer Active) */
/* Front layer returns to 0 */
body:not(.layer-back-active) #layer-front,
body:not(.layer-back-active) #bg-layer-front {
  transform: translateY(0) !important;
  opacity: 1;
  transition: transform 1.5s ease-in-out, opacity 1s ease-in-out;
}

/* Persistent UI (Buttons) always stays visible and on top (z-index 100 defined in index.astro) */


/* Back Layer Content Toggling */
.layer-foreground {
  display: none;
  font-size: 1.5rem;
  font-weight: bold;
}

/* Enable View Transitions for text morphing */
.layer-background, .layer-foreground {
  view-transition-name: hero-text;
}

body.layer-back-active #layer-back .layer-background,
body.layer-back-active #layer-right .layer-background {
  display: none;
}

body.layer-back-active #layer-back .layer-foreground,
body.layer-back-active #layer-right .layer-foreground {
  display: block;
}

/* When Front Layer is Active (default state / !layer-back-active) */
body:not(.layer-back-active) #layer-front .layer-foreground {
  display: block;
}
body:not(.layer-back-active) #layer-front .layer-background {
  display: none;
}

/* Cube containers: unified opacity and motion handled in page styles */


/* --- Idle Mode (Auto-hide UI) --- */

/* Add transitions to layers that might not have them on the container level */
#layer-persistent .global-controls {
  transition: opacity 0.5s ease, transform 0.3s ease, visibility 0s linear 0s;
}


/* When idle, fade out controls (Buttons & Player) but keep text/titles visible */
body.user-idle #layer-persistent .global-controls {
  opacity: 0 !important;
  visibility: hidden;
  /* Delay visibility hide until opacity is done (1.5s) */
  transition: opacity 1.5s ease-in-out, transform 0.3s ease, visibility 0s linear 1.5s !important;
}

/* Added comments to replace deleted blocks */

/* iOS/WebKit safeguard: disable heavy filters/masks that can blank WebGL on Chrome/Ecosia iOS */
@supports (-webkit-touch-callout: none) {
  .renderer-container,
  #world-background-container,
  .layer-background,
  .layer-foreground,
  .fallback-container,
  .loader {
    -webkit-backdrop-filter: none !important;
    backdrop-filter: none !important;
    -webkit-mask-image: none !important;
    mask-image: none !important;
  }

  /* iOS 26+ supports light-dark() - use it for theme-aware background */
  @supports (color: light-dark(#000, #fff)) {
    /* Ensure a visible base behind the canvas with theme support */
    #world-background-container {
      background: light-dark(#fff, #000) !important;
    }
    
    .loader {
      background: light-dark(rgba(255, 255, 255, 0.55), rgba(0, 0, 0, 0.55)) !important;
    }
  }
  
  /* Fallback for older iOS versions that don't support light-dark() */
  @supports not (color: light-dark(#000, #fff)) {
    /* Ensure a visible base behind the canvas */
    #world-background-container {
      background: #000 !important;
    }
    
    /* Theme-aware background for world container */
    body.light-mode #world-background-container {
      background: #fff !important;
    }
    
    body.dark-mode #world-background-container {
      background: #000 !important;
    }

    /* Avoid overdraw spikes on overlays */
    .loader {
      background: rgba(0, 0, 0, 0.55) !important;
    }
    
    /* Theme-aware loader background */
    body.light-mode .loader {
      background: rgba(255, 255, 255, 0.55) !important;
    }
    
    body.dark-mode .loader {
      background: rgba(0, 0, 0, 0.55) !important;
    }
  }
}